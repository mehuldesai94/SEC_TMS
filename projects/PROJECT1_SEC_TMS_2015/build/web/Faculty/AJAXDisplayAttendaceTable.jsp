<%@page import="java.util.List"%><%@page import="com.tms.*"%><%@page contentType="text/html" pageEncoding="UTF-8"%>                <%              try{            DBCon conobj=new DBCon();            String type=request.getParameter("type");            String searchdate=request.getParameter("date");            String[][] students=new String[500][2];            String buildtbl="<tr><td>No data Avaialable</td><td></td><td></td><td></td><td></td></tr>";//            System.out.println("Inside AJAXDisplayAttendaceTable");            int total_lec=1;            int total_sub=0;            int attend_lec=0;            int totalstu=0;            double attendper=0.0;            String subjectid=request.getParameter("sub");            System.out.print("\nsubjectid:"+subjectid);            String fid="";            String totalstudents="SELECT subc.studentidfk,stm.studentname FROM `subjectchoicedetails` subc, `studentmaster` stm WHERE subc.SubjectIdFK='"+subjectid+"' AND subc.studentidfk=stm.studentid ";            String totallecquery="SELECT COUNT(DISTINCT`AttendanceDate`)totallec FROM `attendancemaster` WHERE `SubjectIdFK`='"+subjectid+"'";            String totalstudentlecquery="";                  if(session.getAttribute("fid")!=null)                        fid=session.getAttribute("fid").toString();           System.out.println("Inside AJAXDisplayAttendaceTable with subid:"+subjectid);           List<Object[]> rs=null;                       //For finding studentname and studentid enrolled in this subject                rs=null;                rs=conobj.FetchData(totalstudents);                for(Object rowObject:rs)                {                    Object[] row=(Object[])rowObject;                    if(row[0]!=null && row[1]!=null)                    {                //           System.out.println("now totalstudents is:"+totalstu);                        students[totalstu][0]=row[0].toString();                        students[totalstu][1]=row[1].toString();                        totalstu++;                     }                }           //     System.out.println("Total student for this subject is:"+totalstu);                                  if(subjectid!=null || !subjectid.equals(""))            {                if(type.equals("AdvSearch") && searchdate!=null)                {                            String lecture_at_date="SELECT stu.studentid,stu.studentname FROM `attendancemaster` atm,`studentmaster` stu WHERE atm.attendancedate='"+new General().dateCon(searchdate)+"' AND atm.subjectidfk='"+subjectid+"' AND stu.studentid=atm.studentidfk";                            System.out.println("query:"+lecture_at_date);                            String[][] students_d=new String[200][1];                            int totalstu_d=0;                            if (totalstu == 0) {                                    buildtbl = "<tr><td>No lectures are taken for this subject!</td><td></td><td></td></tr>";                                } else {                                        rs = conobj.FetchData(lecture_at_date);                                        for (Object rowObject : rs) {                                            Object[] row = (Object[]) rowObject;                                            if (row[0] != null && row[1] != null) {                                                //           System.out.println("now totalstudents is:"+totalstu);                                                students_d[totalstu_d][0] = row[0].toString();                                                students_d[totalstu_d][1] = row[1].toString();                                                totalstu_d++;                                            }                                        }                                        System.out.print("Total student present:" + totalstu_d);                                            for (int i = 0; i < totalstu_d; i++) {                                                System.out.println("Stduent name:" + students_d[i][1]);                                                System.out.println("Stduent id:" + students_d[i][0]);                                            }                                                                            }                           }                                else                {                //For total lectures for perticular subjectid                                rs=conobj.FetchData(totallecquery);                for(Object rowObject:rs)                {                    Object[] row=(Object[])rowObject;                    if(row[0]!=null)                        total_lec=Integer.parseInt(row[0].toString());                }                System.out.println("\n\nTotal lectures for "+subjectid+" are:"+total_lec);//                System.out.print("Total student:"+totalstu);//                for(int i=0;i<totalstu;i++)//                {//                System.out.println("Stduent name:"+students[i][1]);//                System.out.println("Stduent id:"+students[i][0]);//                }//                //                               if(total_lec==0)                {                    attendper=0.0;                    buildtbl="<tr><td>No lectures are taken for this subject!</td><td></td><td></td></tr>";                }                else                    {                buildtbl="";                String truncate="Delete from `db_sec_tms`.`AttendanceReport`";                //String initquery="CREATE or Replace TABLE `db_sec_tms`.`AttendanceReport`( `StudentId` VARCHAR(20) NOT NULL, `StudentName` VARCHAR(50), `Attend_per` NUMERIC(4) NOT NULL, PRIMARY KEY (`StudentId`) )";                 //String insertq="Insert into `db_sec_tms`.`AttendanceReport` values(";                String empty=conobj.INSUPDEL(truncate);                System.out.println("\nTable query rs:"+empty);                for(int i=0;i<totalstu;i++)                {                    buildtbl+="<tr><td><center>";                    totalstudentlecquery="SELECT COUNT(DISTINCT`AttendanceDate`)presentlec FROM `attendancemaster` WHERE `SubjectIdFK`='"+subjectid+"' AND `StudentIdFK`='"+students[i][0]+"'";                    rs=conobj.FetchData(totalstudentlecquery);                    String insertq="Insert into `db_sec_tms`.`AttendanceReport` values(";                    for(Object rowObject:rs)                    {                        Object[] row=(Object[])rowObject;                        if(row[0]!=null)                            attend_lec=Integer.parseInt(row[0].toString());                    }                attendper=(attend_lec*1.0/total_lec)*100;                System.out.println("Stduent name:"+students[i][1]);                System.out.println("Stduent id:"+students[i][0]);                System.out.println("attended lectures and percentage are:"+attend_lec+"("+attendper+"%)");                insertq+="'"+students[i][0]+"','"+students[i][1]+"','"+attendper+"')";                System.out.println("Query:"+insertq);                empty=conobj.INSUPDEL(insertq);                System.out.println("\nAfter insupdel:"+empty);                if(empty.equals("Success"))                {                    new General().generateReport("pdf","");                }                                buildtbl+=students[i][0]+"</td><td>"+students[i][1]+"</td>";                 if(attendper<=75.0)                     buildtbl+="<td>"+attend_lec+"&nbsp;<Strong><font color=\"red\">("+attendper+"%)</font></Strong></td></tr>";                 else                      buildtbl+="<td>"+attend_lec+"&nbsp;<Strong><font color=\"green\">("+attendper+"%)</font></Strong></td></tr>";                }                }                //buildtbl+="<>";                if(buildtbl!="" || !buildtbl.equals("<tr><td>No lectures are taken for this subject!</td><td></td><td></td></tr>"))                {                                       }            }            }                                                      //                  String absent_student="";//            String present_student="";//            GenFun genobj=new GenFun();//            //            System.out.println("Subject code:"+request.getParameter("sub"));//                if(request.getParameter("sub")!=null && request.getParameter("type")!=null || request.getParameter("date")!=null)//                {//                    type=request.getParameter("type");//                    subjectid=(request.getParameter("sub"));//                    if(session.getAttribute("fid")!=null)//                        fid=session.getAttribute("fid").toString();//                    else//                                    session.invalidate();//                    if(type.equals("Student"))//                   {                    //                    present_student="SELECT s.studentid,s.studentname,a.`AttendanceDate`,a.`AttendanceDay`,a.attendancetype FROM `attendancemaster` a, `studentmaster` s WHERE subjectidfk='"+subjectid+"' AND facultyidfk='"+fid+"' AND a.studentidfk=s.studentid";//                    //absent_student="SELECT s.studentid,s.studentname FROM `studentmaster` s,`subjectchoicedetails` sc WHERE s.studentid NOT IN ("+absent_student+") AND sc.subjectIDFK='"+subjectid+"' AND sc.studentidfk=s.studentid";//                    absent_student="SELECT DISTINCT StudentId,StudentName,AttendanceDate,AttendanceDay,'A'  FROM studentmaster,attendancemaster,subjectchoicedetails WHERE studentmaster.StudentId NOT IN (SELECT DISTINCT StudentIdFK FROM attendancemaster,studentmaster WHERE attendancemaster.StudentIdFK=studentmaster.StudentId AND FacultyIdFK='1' AND SubjectIdFK='11' AND attendancemaster.AttendanceDate='2015-04-23') AND `subjectchoicedetails`.`StudentIdfk` =`studentmaster`.`StudentId` AND `subjectchoicedetails`.`SubjectIdFK`=`attendancemaster`.`SubjectIdFK` AND `subjectchoicedetails`.`StudentIdfk`=attendancemaster.StudentIdfk";//                    buildtbl=genobj.filltbl(present_student,6,"");//                    buildtbl+=genobj.filltbl(absent_student,6,"");//                    }//                    //                    else if(type.equals("Date") && request.getParameter("date").toString()!=null)//                    {//                           String date=request.getParameter("date");//                           String dates[]=date.split("/");//                           System.out.println(dates[0]+" "+dates[1]+" "+dates[2]);//                           date=dates[2]+"-"+dates[0]+"-"+dates[1];//                           System.out.println("New Date:"+date);//                           present_student="Select distinct StudentIdFK ,StudentName,AttendanceDate,AttendanceDay,AttendanceType from attendancemaster,studentmaster where attendancemaster.StudentIdFK=studentmaster.StudentId and FacultyIdFK='"+request.getParameter("faculyid")+"' and SubjectIdFK='"+request.getParameter("sub")+"' and attendancemaster.AttendanceDate='"+date+"'";//                           absent_student="SELECT DISTINCT StudentId,StudentName,AttendanceDate,AttendanceDay,'A'  FROM studentmaster,attendancemaster,subjectchoicedetails WHERE studentmaster.StudentId NOT IN (SELECT DISTINCT StudentIdFK FROM attendancemaster,studentmaster WHERE attendancemaster.StudentIdFK=studentmaster.StudentId AND FacultyIdFK='"+fid+"' AND SubjectIdFK='"+subjectid+"' AND attendancemaster.AttendanceDate='"+date+"') AND `subjectchoicedetails`.`StudentIdfk` =`studentmaster`.`StudentId` AND `subjectchoicedetails`.`SubjectIdFK`=`attendancemaster`.`SubjectIdFK` AND `subjectchoicedetails`.`StudentIdfk`=attendancemaster.StudentIdfk and attendancemaster.SubjectIdFK='"+subjectid+"'";//                           buildtbl=genobj.filltbl(present_student,6,"");//                           buildtbl+=genobj.filltbl(absent_student,6,"");   //                    }                                        out.print(buildtbl);                    out.flush();                }catch(Exception ex)                {                    out.println("Soory we get back to you soon!\n Error:"+ex.toString());                 }        %>                        